@{
    ViewBag.Title = "Book Appointment";
}

<h2>Book Appointment</h2>

<form asp-action="BookSlot" method="post">
    <div class="form-group">
        <label for="specialization">Select Specialization</label>
        <select class="form-control" id="specialization" name="specialization" required>
            <option value="">-- Select Specialization --</option>
            @foreach (var specialization in ViewBag.Specializations)
            {
                <option value="@specialization">@specialization</option>
            }
        </select>
    </div>

    <div class="form-group" id="doctorContainer" style="display: none;">
        <label for="doctorId">Select Doctor</label>
        <select class="form-control" id="doctorId" name="doctorId" required>
            <option value="">-- Select Doctor --</option>
            <!-- Options will be populated via JavaScript -->
        </select>
    </div>

    <div class="form-group" id="dateContainer" style="display: none;">
        <label for="date">Select Date</label>
        <input type="date" class="form-control" id="date" name="date" required />
    </div>

    <div class="form-group" id="slotContainer" style="display: none;">
        <label for="slot">Select Time Slot</label>
        <select class="form-control" id="slot" name="slot" required>
            <!-- Options will be populated via JavaScript -->
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Book Appointment</button>
</form>

@section Scripts {
    <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.5.1.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#specialization').change(function () {
                var specialization = $(this).val();
                if (specialization) {
                    $.post('@Url.Action("GetDoctors")', { specialization: specialization }, function (data) {
                        var doctorSelect = $('#doctorId');
                        doctorSelect.empty();
                        doctorSelect.append('<option value="">-- Select Doctor --</option>');
                        $.each(data, function (index, doctor) {
                            doctorSelect.append('<option value="' + doctor.doctorId + '">' + doctor.firstName + ' ' + doctor.lastName + ' - ' + doctor.specialty + '</option>');
                        });
                        $('#doctorContainer').show();
                    });
                }
            });

            $('#doctorId').change(function () {
                $('#dateContainer').show();
            });

            $('#date').change(function () {
                var doctorId = $('#doctorId').val();
                var date = $(this).val();
                if (doctorId && date) {
                    $.post('@Url.Action("GetAvailableSlots")', { doctorId: doctorId, date: date }, function (data) {
                        var slotSelect = $('#slot');
                        slotSelect.empty();
                        slotSelect.append('<option value="">-- Select Slot --</option>');
                        if (data) {
                            if (data.slot1) slotSelect.append('<option value="1">10-11 AM</option>');
                            if (data.slot2) slotSelect.append('<option value="2">11-12 AM</option>');
                            if (data.slot3) slotSelect.append('<option value="3">2-3 PM</option>');
                            if (data.slot4) slotSelect.append('<option value="4">3-4 PM</option>');
                        }
                        $('#slotContainer').show();
                    });
                }
            });
        });
    </script>
}


<div class="mt-3">
    <a href="@Url.Action("Logout", "Patient")" class="btn btn-danger">Logout</a>
</div>
